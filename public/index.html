<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <!-- dd -->
    <script src="https://gftruj.github.io/webzamples/aframe/controls/oculus-thumbstick-controls.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v$npm_package_version/dist/aframe-physics-system.min.js"></script> -->
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.misc.min.js"></script>
    <!-- <script src="https://unpkg.com/super-hands@^3.0.3/dist/super-hands.min.js"></script> -->

    <script src="https://unpkg.com/super-hands/dist/super-hands.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v4.0.1/dist/aframe-physics-system.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@^4.1.1/dist/aframe-event-set-component.min.js"></script>
    <script src="https://unpkg.com/aframe-physics-extras/dist/aframe-physics-extras.min.js"></script>
  </head>
  <!-- <script>
    AFRAME.registerComponent('x-button-listener', {
  init: function () {
    var el = this.el;

    el.addEventListener('mouseenter', function (evt) {
      el.setAttribute("scale", {
            x: 1.5,
            y: 1.5,
            z: 1.5
          })
    });
  }
});
  </script> -->
  <script>
    document.querySelector("#rig").object3D.position.set(1, 1, 1)
    let a = document.getElementById("gummy1")
    a.addEventListener("ondrag", function () {
      alert("okay")
      a.setAttribute("scale", {
        x: 0.2,
        y: 2,
        z: 2.2,
      })
    })

    AFRAME.registerComponent("phase-shift", {
      init: function () {
        var el = this.el
        el.addEventListener("ulus-thumbstick-co", function () {
          el.setAttribute("collision-filter", { collisionForces: true })
        })
        el.addEventListener("gripup", function () {
          el.setAttribute("collision-filter", { collisionForces: false })
        })
      },
    })
  </script>
  <body>
    <a-scene physics>
      <!-- Adding all the assets -->
      <a-assets>
        <img id="sky" src="./sky.jpeg" />
        <a-asset-item id="mugblack" src="./mugblack.glb"></a-asset-item>
        <a-asset-item id="gummy" src="./gummy.glb"></a-asset-item>
        <a-asset-item id="cart" src="./cart.glb"></a-asset-item>

        <!-- Creating mixin for gummy bear -->
        <a-mixin
          id="mugblack-mixin"
          gltf-model="#gummy"
          rotation="0 -180 0"
          scale="0.5 0.5 0.5"
          grabbable
          draggable
          dynamic-body
        ></a-mixin>

        <!-- Creating mixin for hands -->
        <a-mixin
          id="physics-hands"
          physics-collider
          phase-shift
          collision-filter="collisionForces: false"
          static-body="shape: sphere; sphereRadius: 2"
          super-hands="colliderEvent: collisions; colliderEventProperty: els; colliderEndEvent: collisions; colliderEndEventProperty: clearedEls;"
        ></a-mixin>
      </a-assets>

      <!-- Adding Sky -->
      <a-sky src="#sky"></a-sky>

      <!-- Adding Camera -->
      <a-entity
        id="rig"
        movement-controls="fly: true"
        position="15 2.5 1"
        rotation="-10 80 0"
      >
        <a-camera
          look-controls="enabled: true"
          wasd-controls="enabled: true; acceleration:50"
        >
          <a-cursor></a-cursor>
          <!-- <a-entity cursor raycaster="far: 20; interval: 1000; objects: .clickable"></a-entity> -->
        </a-camera>
        <!-- Adding controller to oculus -->
        <a-entity
          sphere-collider="objects: .gummy1, .gummy2, .gummy3, .cart"
          raycaster="lineColor: yellow; far: 50;"
          oculus-thumbstick-controls
          hand-controls="hand: left; handModelStyle: lowPoly; color: #ffcccc"
          mixin="physics-hands"
        ></a-entity>

        <a-entity
          sphere-collider="objects: .gummy1, .gummy2, .gummy3, .cart"
          raycaster="lineColor: pink; far: 50;"
          oculus-thumbstick-controls
          hand-controls="hand: right; handModelStyle: lowPoly; color: #ffcccc"
          mixin="physics-hands"
        ></a-entity>
      </a-entity>

      <!-- SHELF -->
      <a-box
        position="7 2 0"
        width="5"
        height="5"
        depth="0.1"
        rotation="0 90 0"
      >
        <!-- top shelf -->
        <a-box width="5" depth="0.9" height="0.05" position="0 2 0.5"></a-box>
        <a-box width="5" depth="0.9" height="0.05" position="0 1 0.5"> </a-box>

        <a-box width="5" depth="0.9" height="0.05" position="0 0 0.5">
          <!-- Adding gummy bear -->
          <!-- <a-entity class="gummy1" gltf-model="#gummy" position="0 0.38 0" rotation="0 -180 0" x-button-listener></a-entity> -->
          <a-entity
            class="gummy1"
            mixin="mugblack-mixin"
            position="0 0.38 0"
            event-set__start="_event: grab-start; _target: .gummy1; material.color: red"
            event-set__end="_event: grab-end; _target: .gummy1; material.color: yellow"
          ></a-entity>

          <a-entity
            class="gummy2"
            mixin="mugblack-mixin"
            position="2 0.38 0"
            event-set__start="_event: grab-start; _target: .gummy2; material.color: red"
            event-set__end="_event: grab-end; _target: .gummy2; material.color: yellow"
          ></a-entity>

          <a-entity
            class="gummy3"
            mixin="mugblack-mixin"
            position="-2 0.38 0"
            event-set__start="_event: grab-start; _target: .gummy3; material.color: red"
            event-set__end="_event: grab-end; _target: .gummy3; material.color: yellow"
          ></a-entity>

          <!-- mixin="cube grab-move" -->
        </a-box>
        <!-- bottom-shelf -->
        <a-box width="5" depth="0.9" height="0.05" position="0 -1 0.5">
          <!-- Adding all the black bugs -->
          <a-entity
            gltf-model="#mugblack"
            position="0 -0.3 0"
            rotation="0 -35 0"
            scale="0.5 0.5 0.5"
          ></a-entity>
          <a-entity
            gltf-model="#mugblack"
            position="2 -0.3 0"
            rotation="0 -35 0"
            scale="0.5 0.5 0.5"
          ></a-entity>
          <a-entity
            gltf-model="#mugblack"
            position="-2 -0.3 0"
            rotation="0 -35 0"
            scale="0.5 0.5 0.5"
          ></a-entity>
        </a-box>

        <a-entity
          class="cart"
          class="cart"
          gltf-model="#cart"
          position="-1 -2 3"
          rotation="0 -125 0"
          scale="1.5 1.5 1.5"
          grabbable="invert: true;"
        ></a-entity>
      </a-box>

      <!-- FLOOR -->
      <a-plane
        id="floor"
        height="30"
        width="30"
        position="10 0 0 "
        src="./floor.jpeg"
        rotation="-90 30 0"
        static-body
      />
    </a-scene>
  </body>
</html>

<!--  
1. pointer intractions(hover, click)
2. card for product details
3. animation of components(shelf-> front, front-> basket)(physics)
4. checkout
5. success animation or message.
. Hand tracking support
. Camera Movement
-->
